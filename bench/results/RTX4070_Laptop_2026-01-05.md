# Mind Ray CUDA Benchmark Results

## Configuration

| Parameter | Value |
|-----------|-------|
| **Date** | 2026-01-05 01:14 PST |
| **Git Commit** | c22ee45 |
| **Backend** | CUDA (mindray_cuda.dll direct FFI) |
| **Build Mode** | Release (`-O3 -use_fast_math`) |

### Hardware

| Component | Value |
|-----------|-------|
| **GPU** | NVIDIA GeForce RTX 4070 Laptop GPU (AD106, 4,608 CUDA cores) |
| **GPU VRAM** | 8 GB GDDR6 |
| **GPU TGP** | Varies by laptop; power mode not locked |
| **GPU Driver** | 591.44 |
| **CUDA Toolkit** | 12.8 (V12.8.93) |
| **CPU** | (see `cpu.txt` for model) |
| **RAM** | (see `systeminfo.txt` for amount) |
| **OS** | Windows 11 |

### Benchmark Parameters

| Parameter | Value |
|-----------|-------|
| **Resolution** | 640x360 (230,400 pixels) |
| **SPP** | 64 samples per pixel |
| **Max Bounces** | 4 (excluding primary ray; see definition below) |
| **Seed** | 42 |
| **Warmup Frames** | 2 (excluded from timing) |
| **Measured Frames** | 5 |
| **Timer** | Windows QueryPerformanceCounter |

## Results

| Scene | Total Time (5 frames) | ms/frame | Samples/sec | Rays/sec (upper bound) |
|-------|----------------------|----------|-------------|------------------------|
| spheres | 43 ms | 8.6 ms | 1,731 M | 6,924 M |
| cornell | 84 ms | 16.8 ms | 880 M | 3,520 M |
| stress | 110 ms | 22.0 ms | 670 M | 2,681 M |

## Methodology

### Timing
- High-resolution timer: `QueryPerformanceCounter` (Windows)
- Timing starts after warmup frames complete
- Timing ends after all benchmark frames complete (includes GPU sync via `cudaDeviceSynchronize`)
- **Does NOT include**: DLL load, buffer allocation, PPM file write
- **DOES include**: kernel launch, execution, device synchronization

### Bounces Definition

In this benchmark, **"bounces" = max path segments after the primary ray**.

- `bounces=0`: primary ray only (direct lighting)
- `bounces=4`: primary ray + up to 4 scatter events

This is equivalent to `max_depth = bounces + 1` in renderers that count total segments.

### Metric Definitions

**Samples/sec:**
```
total_samples = width × height × spp × frames
              = 640 × 360 × 64 × 5
              = 73,728,000 samples

samples_per_sec = total_samples / total_time_seconds
```
This is the number of complete pixel samples computed per second. Each sample includes the full path tracing computation (primary ray + bounces).

**Rays/sec (upper bound):**
```
total_rays = width × height × spp × (bounces + 1) × frames
           = 640 × 360 × 64 × 5 × 5
           = 368,640,000 rays (maximum)

rays_per_sec = total_rays / total_time_seconds
```
This is an **UPPER BOUND** on rays processed. Actual ray count is lower due to:
- Rays that miss all geometry (terminate early)
- Russian roulette path termination
- Rays absorbed by materials

The true ray count would require GPU-side instrumentation.

### What a "Sample" Is

One sample = one complete path trace for one pixel:
1. Generate camera ray through pixel (with AA jitter)
2. Trace ray, find intersection
3. Evaluate material, scatter new ray
4. Repeat up to `max_bounces` times
5. Accumulate radiance contribution

### Scene Complexity

| Scene | Spheres | Rects | Planes | Materials | Notes |
|-------|---------|-------|--------|-----------|-------|
| spheres | 3 | 0 | 1 | 4 | Simple, fast |
| cornell | 2 | 6 | 0 | 6 | Enclosed box with area light |
| stress | 64 | 0 | 1 | 5 | 8×8 grid, O(n) intersection |

## Commands Used

### Build CUDA DLL
```powershell
cd native-cuda
nvcc -O3 -use_fast_math -shared -o mindray_cuda.dll mindray_cuda.cu -Xcompiler /MD -Wno-deprecated-gpu-targets
```

### Build Benchmark Harness
```powershell
cd bench
cl /O2 cuda_benchmark.c /Fe:cuda_benchmark.exe
```

### Run Benchmarks
```powershell
cd bench
cp ../native-cuda/mindray_cuda.dll .
./cuda_benchmark.exe --scene spheres --width 640 --height 360 --spp 64 --bounces 4
./cuda_benchmark.exe --scene cornell --width 640 --height 360 --spp 64 --bounces 4
./cuda_benchmark.exe --scene stress --width 640 --height 360 --spp 64 --bounces 4
```

## Raw Output

Raw console output is saved to `raw/` directory. The values below are copied from those files.

### spheres
```
=== Mind Ray CUDA Benchmark ===

CUDA devices: 1
Device 0: NVIDIA GeForce RTX 4070 Laptop GPU

Config:
  Resolution: 640x360
  SPP: 64
  Bounces: 4
  Scene: spheres
  Seed: 42
  Warmup frames: 2
  Benchmark frames: 5

Warmup (2 frames)...
Benchmarking (5 frames)...

=== Results ===
Total time: 0.043 s
Time per frame: 0.009 s
Samples/sec: 1730.96 M
Rays/sec: 6923.86 M

Benchmark complete.
```

### cornell
```
=== Mind Ray CUDA Benchmark ===

CUDA devices: 1
Device 0: NVIDIA GeForce RTX 4070 Laptop GPU

Config:
  Resolution: 640x360
  SPP: 64
  Bounces: 4
  Scene: cornell
  Seed: 42
  Warmup frames: 2
  Benchmark frames: 5

Warmup (2 frames)...
Benchmarking (5 frames)...

=== Results ===
Total time: 0.084 s
Time per frame: 0.017 s
Samples/sec: 879.93 M
Rays/sec: 3519.72 M

Benchmark complete.
```

### stress
```
=== Mind Ray CUDA Benchmark ===

CUDA devices: 1
Device 0: NVIDIA GeForce RTX 4070 Laptop GPU

Config:
  Resolution: 640x360
  SPP: 64
  Bounces: 4
  Scene: stress
  Seed: 42
  Warmup frames: 2
  Benchmark frames: 5

Warmup (2 frames)...
Benchmarking (5 frames)...

=== Results ===
Total time: 0.110 s
Time per frame: 0.022 s
Samples/sec: 670.31 M
Rays/sec: 2681.23 M

Benchmark complete.
```

## Notes

1. **GPU specs**: The RTX 4070 Laptop GPU has 4,608 CUDA cores (AD106 die). TGP varies by laptop model (typically 80-140W); power mode was not locked for this benchmark.

2. **No BVH**: Mind-Ray uses brute-force O(n) intersection testing. The stress scene (64 spheres) shows ~2.6× slowdown vs spheres (3 spheres), demonstrating roughly linear scaling with geometry count.

3. **Progressive accumulation**: Each frame's results are accumulated using exponential moving average. The benchmark runs 5 frames but reports per-frame timing.

4. **Determinism**: Seed 42 produces identical output across runs. Verify with `mind-ray verify --seed 42`.

5. **Variance**: GPU benchmarks typically have 1-5% variance between runs due to thermal state, background processes, and driver scheduling.

## Raw Data Files

- `raw/spheres_640x360.txt` - spheres scene console output
- `raw/cornell_640x360.txt` - cornell scene console output
- `raw/stress_640x360.txt` - stress scene console output
- `cpu.txt` - CPU model
- `gpu.txt` - GPU identifier
- `gpu_details.txt` - GPU driver and memory
- `nvcc.txt` - CUDA compiler version
- `systeminfo.txt` - Full Windows system info
